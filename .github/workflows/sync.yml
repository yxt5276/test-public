name: Sync to Public Repo

on:
  push:
    branches:
      - main

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout private repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Important to preserve full history

      - name: Push to public repo
        run: |
          AUTHOR_NAME="$(git log -1 --pretty=format:'%an')"
          AUTHOR_EMAIL="$(git log -1 --pretty=format:'%ae')"
          echo "$AUTHOR_NAME"
          echo "$AUTHOR_EMAIL"
          git config --global user.name "$AUTHOR_NAME"
          git config --global user.email "$AUTHOR_EMAIL"
          
          git remote remove origin || true
          git remote add public https://x-access-token:${{ secrets.PUBLIC_TOKEN }}@github.com/yxt5276/test-public.git

          git push --force public HEAD:main

